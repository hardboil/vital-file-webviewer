# VitalDB Viewer UI/UX 개선 스펙

## 프로젝트 개요

VitalDB Viewer의 UI/UX를 개선하여 원본의 Track View와 수정 코드의 Monitor View를 통합하고, Canvas 기반 시각화를 유지하면서 사용자 경험을 향상시킵니다.

---

## 1. 대상 사용자

| 사용자 그룹 | 주요 니즈 |
|------------|----------|
| 의료 교육용 | 활력징후 패턴 학습, 실시간 모니터 시뮬레이션 |
| 연구자/데이터분석가 | VitalDB 데이터셋 탐색, 논문용 시각화 |
| 개발자/기술팀 | 의료 모니터링 시스템 프로토타이핑 |

---

## 2. 뷰 모드 설계

### 2.1 두 가지 뷰 모드 통합

```
┌─────────────────────────────────────────────────────────────────┐
│  [ ≡ ]  VitalDB Viewer                            [Track View ▼]│
├────────────────────┬────────────────────────────────────────────┤
│                    │                                            │
│   SIDEBAR          │        MAIN CANVAS AREA                    │
│   (collapsible)    │                                            │
│                    │   ┌────────────────────────────────────┐   │
│   ☐ View Mode      │   │                                    │   │
│     ○ Monitor      │   │   Monitor View (default)           │   │
│     ● Track        │   │     or                              │   │
│                    │   │   Track View                        │   │
│   ☐ Data Source    │   │                                    │   │
│                    │   └────────────────────────────────────┘   │
│   ☐ Track Filter   │                                            │
│     ☑ ECG          │   ┌────────────────────────────────────┐   │
│     ☑ ABP          │   │   Playback Controls + Minimap      │   │
│     ☐ PLETH        │   └────────────────────────────────────┘   │
│                    │                                            │
└────────────────────┴────────────────────────────────────────────┘
```

### 2.2 뷰 모드 특징

| 항목 | Monitor View (기본) | Track View |
|-----|---------------------|------------|
| 용도 | 실시간 파라미터 모니터링 | 전체 시계열 탐색 |
| 데이터 표시 | 현재 시점 기준 sweep | 전체 녹화 시간 표시 |
| 상호작용 | 재생/일시정지, 탐색 | 줌/패닝, 범위 선택 |
| 레이아웃 | Wave Groups + Params | 다중 트랙 스택 |

---

## 3. 레이아웃 설계

### 3.1 접을 수 있는 사이드바

```
[접힌 상태]                    [펼친 상태]
┌──┬──────────────────┐       ┌─────────┬──────────────────┐
│≡ │                  │       │  SIDEBAR│                  │
│  │   Canvas Area    │  ←→   │  (256px)│   Canvas Area    │
│  │   (최대화)        │       │         │                  │
└──┴──────────────────┘       └─────────┴──────────────────┘
```

**사이드바 구성요소:**
1. View Mode 선택 (Monitor/Track 라디오 버튼)
2. Data Source 선택 (Local File, VitalDB, Local Data)
3. Track Filter (체크박스로 표시/숨김)
4. Settings (waveform 표시 모드, 내보내기)
5. Recent Files (최근 5-10개 파일 목록)

### 3.2 재생 컨트롤 + 미니맵

```
┌─────────────────────────────────────────────────────────────────┐
│   [Minimap: 전체 파형 미리보기, 현재 위치 하이라이트]             │
├─────────────────────────────────────────────────────────────────┤
│   [────────────●───────────────────] Timeline Slider            │
├─────────────────────────────────────────────────────────────────┤
│   [⏮][⏪][▶][⏩][⏭]  │  Speed [x1][x2][x4][x8]  │  00:05:23 / 02:30:00 │
├─────────────────────────────────────────────────────────────────┤
│   Markers: [A] 00:12:34  [B] 00:45:00  [+Add]  │  [Loop A-B]    │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. Track View 상호작용

### 4.1 마우스 상호작용

| 동작 | 기능 |
|-----|------|
| 휠 스크롤 | 시간축 확대/축소 |
| 드래그 (좌클릭) | 시간축 패닝 |
| 클릭 | 해당 시점으로 currentTime 이동 |
| 드래그 (Shift+좌클릭) | 시간 범위 선택 |
| 더블클릭 | 확대 레벨 초기화 |

### 4.2 트랙 선택/필터

- 사이드바 체크박스로 개별 트랙 표시/숨김
- 드래그앤드롭으로 트랙 순서 변경
- 그룹 접기/펼치기 (ECG Group, ABP Group 등)

### 4.3 Waveform 표시 모드 (사용자 선택)

| 모드 | 설명 |
|-----|------|
| 스크롤 기반 | 세로 스크롤로 전체 데이터 탐색 (원본 방식) |
| 고정 시간창 | 화면에 고정 시간(예: 30초) 표시, Timeline으로 이동 |

---

## 5. 데이터 소스

### 5.1 세 가지 소스 균형 지원

```
┌─────────────────────────────┐
│  Data Source                │
├─────────────────────────────┤
│  ○ Local File               │
│    [Drop zone / Browse]     │
│                             │
│  ○ VitalDB Open Dataset     │
│    [Browse Dataset]         │
│                             │
│  ○ Local Data Files         │
│    [Select ▼] [Load]        │
└─────────────────────────────┘
```

### 5.2 VitalDB 브라우저 개선

**고급 필터 추가:**
- 부서 (Department) - 기존
- Case ID 검색 - 기존
- 수술 종류 (Operation Type) - 신규
- 나이 범위 (Age Range) - 신규
- 성별 (Sex) - 신규
- 녹화 시간 (Duration Range) - 신규

```
┌──────────────────────────────────────────────────────────────┐
│  VitalDB Open Dataset                              [×]       │
├──────────────────────────────────────────────────────────────┤
│  Search: [____________]  Department: [All ▼]                 │
│  Op Type: [All ▼]  Age: [__]-[__]  Sex: [All ▼]  Dur: [__]h+ │
├──────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────────────────────────────────┐  │
│  │ Case 0001  │ M/45 │ General Surgery │ Lap. Chole.      │  │
│  │ Case 0002  │ F/62 │ Cardiac Surgery │ CABG             │  │
│  │ ...                                                    │  │
│  └────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────┘
```

---

## 6. Patient Info 패널

### 6.1 확장 가능한 패널

```
[축소 상태]
┌─────────────────────────────────────────────────────────────┐
│ Case 0001 │ M/45 │ General Surgery │ Lap. Cholecystectomy [▼]│
└─────────────────────────────────────────────────────────────┘

[확장 상태]
┌─────────────────────────────────────────────────────────────┐
│ Case 0001 │ M/45 │ General Surgery │ Lap. Cholecystectomy [▲]│
├─────────────────────────────────────────────────────────────┤
│  ASA: II    BMI: 24.5    Weight: 72kg    Height: 170cm      │
│  Surgery Duration: 2h 30m    Anesthesia: General            │
│  Emergency: No    Recording: 3h 15m                         │
└─────────────────────────────────────────────────────────────┘
```

---

## 7. 내보내기 기능

### 7.1 지원 형식

| 기능 | 형식 | 설명 |
|-----|------|------|
| 스크린샷 | PNG/SVG | 현재 Canvas 화면 저장 |
| 구간 CSV | CSV | 선택한 시간 범위의 데이터 |
| 전체 CSV | CSV | 전체 녹화 데이터 |
| 클립 저장 | .vital | 선택 구간을 새 vital 파일로 추출 |

### 7.2 내보내기 UI

```
┌───────────────────────────┐
│  Export                   │
├───────────────────────────┤
│  [📷 Screenshot]          │
│  [📊 CSV (Selection)]     │
│  [📊 CSV (Full)]          │
│  [✂️ Clip (.vital)]       │
└───────────────────────────┘
```

---

## 8. 키보드 단축키

### 8.1 기본 단축키

| 키 | 기능 |
|----|------|
| `Space` | 재생/일시정지 |
| `←` / `→` | 7초 뒤로/앞으로 |
| `Home` / `End` | 처음/끝으로 이동 |

### 8.2 확장 단축키

| 키 | 기능 |
|----|------|
| `+` / `-` | 시간축 확대/축소 |
| `0` | 확대 레벨 초기화 |
| `V` | View Mode 전환 (Monitor ↔ Track) |
| `S` | 사이드바 토글 |
| `F` | 트랙 필터 패널 토글 |
| `M` | 현재 위치에 마커 추가 |
| `Ctrl+S` | 스크린샷 저장 |
| `Ctrl+E` | 내보내기 메뉴 열기 |
| `1-8` | 재생 속도 변경 (x1~x8) |

---

## 9. 성능 최적화

### 9.1 점진적 로딩

```
1. 파일 로드 시작
   ↓
2. 헤더/메타데이터 파싱 (즉시)
   ↓
3. 첫 30초 데이터 로드 → UI 표시
   ↓
4. 백그라운드에서 나머지 데이터 로드
   ↓
5. 로딩 진행률 표시
   ↓
6. 완료
```

### 9.2 렌더링 최적화

- `requestAnimationFrame` 기반 60fps 렌더링
- 보이는 영역만 렌더링 (viewport culling)
- Waveform 데이터 다운샘플링 (줌 레벨에 따라)
- Canvas 레이어 분리 (정적/동적 요소)

---

## 10. 에러 처리

### 10.1 간단 토스트 알림

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                        Canvas Area                              │
│                                                                 │
│                                   ┌─────────────────────────┐   │
│                                   │ ❌ Failed to load file  │   │
│                                   └─────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

- 화면 우측 하단에 3초 표시 후 자동 사라짐
- 에러 유형에 따른 아이콘 (❌ 에러, ⚠️ 경고, ✓ 성공)

---

## 11. 기술 스택

### 11.1 프레임워크/라이브러리

| 항목 | 선택 | 이유 |
|-----|------|------|
| UI | Vanilla JS (ES Module) | 의존성 최소화, 성능 |
| 스타일링 | Tailwind CSS | 빠른 개발, 일관된 디자인 |
| 렌더링 | HTML5 Canvas | 고성능 실시간 렌더링 |
| 빌드 | Vite | 빠른 HMR, ES Module 지원 |
| 압축 | pako | gzip 해제 |

### 11.2 브라우저 호환성

- Chrome (최신)
- Firefox (최신)
- Safari (최신)
- Edge (최신)

---

## 12. 프로젝트 구조

```
/src
├── index.html              # 메인 HTML
├── vite.config.js          # Vite 설정
├── package.json            # 의존성
├── css/
│   └── monitor.css         # 커스텀 스타일
└── js/
    ├── main.js             # 앱 진입점
    ├── config.js           # 설정
    ├── constants.js        # 상수 (MONTYPES, LAYOUTS)
    ├── state.js            # 상태 관리 (Pub/Sub)
    │
    ├── parser/
    │   ├── index.js
    │   ├── vitalParser.js  # .vital 바이너리 파싱
    │   └── trackProcessor.js # Waveform 정규화
    │
    ├── renderer/
    │   ├── index.js
    │   ├── canvasRenderer.js # 메인 렌더러
    │   ├── trackRenderer.js  # Track View 렌더링 (신규)
    │   ├── monitorRenderer.js # Monitor View 렌더링
    │   ├── waveRenderer.js   # Waveform 드로잉
    │   ├── paramRenderer.js  # Parameter 표시
    │   ├── eventRenderer.js  # Event 패널
    │   └── minimapRenderer.js # 미니맵 (신규)
    │
    ├── controls/
    │   ├── index.js
    │   ├── playback.js     # 재생 컨트롤
    │   ├── fileLoader.js   # 파일 로드
    │   ├── trackView.js    # Track View 상호작용 (신규)
    │   ├── markers.js      # 마커/구간 관리 (신규)
    │   └── shortcuts.js    # 키보드 단축키 (신규)
    │
    ├── api/
    │   └── vitaldb.js      # VitalDB API 클라이언트
    │
    ├── export/
    │   ├── index.js
    │   ├── screenshot.js   # 스크린샷 (신규)
    │   ├── csv.js          # CSV 내보내기 (신규)
    │   └── clip.js         # 클립 저장 (신규)
    │
    ├── ui/
    │   ├── sidebar.js      # 사이드바 관리 (신규)
    │   ├── modal.js        # 모달 관리
    │   ├── toast.js        # 토스트 알림 (신규)
    │   └── patientInfo.js  # Patient Info 패널 (신규)
    │
    └── utils/
        ├── time.js         # 시간 포맷팅
        ├── binary.js       # 바이너리 유틸
        └── dom.js          # DOM 유틸 (신규)
```

---

## 13. 구현 우선순위

### Phase 1: 기반 구축
1. 프로젝트 구조 설정 (Vite + ES Module)
2. 기존 Monitor View 코드 이식
3. 접을 수 있는 사이드바 구현
4. 뷰 모드 전환 UI

### Phase 2: Track View 통합
1. Track View 렌더러 구현
2. 마우스 줌/패닝 구현
3. 클릭 시간 이동 구현
4. 트랙 필터 (체크박스) 구현

### Phase 3: 향상된 기능
1. 미니맵 구현
2. 마커/구간 기능
3. 시간 범위 선택
4. Waveform 표시 모드 설정

### Phase 4: 내보내기 + 마무리
1. 스크린샷 내보내기
2. CSV 내보내기 (구간/전체)
3. 클립 저장
4. VitalDB 고급 필터
5. 확장 키보드 단축키
6. 성능 최적화 및 테스트

---

## 14. 테마

### 14.1 현재 의료기기 다크 테마 유지

```css
/* 주요 색상 */
--monitor-bg: #181818;          /* 배경 */
--monitor-panel: #1a1a1a;       /* 패널 */
--monitor-card: #222222;        /* 카드 */
--monitor-border: #333333;      /* 보더 */
--monitor-accent: #00ff00;      /* 액센트 (ECG 그린) */
--monitor-text: #ffffff;        /* 텍스트 */

/* Waveform 색상 */
--ecg-color: #00FF00;           /* ECG - 녹색 */
--abp-color: #FF0000;           /* ABP - 빨강 */
--pleth-color: #82CEFC;         /* PLETH - 하늘색 */
--cvp-color: #FAA804;           /* CVP - 주황 */
--eeg-color: #DAA2DC;           /* EEG - 분홍 */
--resp-color: #FFFF00;          /* RESP - 노랑 */
```

---

## 15. 검증 계획

### 15.1 기능 테스트

1. **파일 로딩**
   - 로컬 파일 드래그앤드롭
   - VitalDB API에서 다운로드
   - Local Data 파일 로드
   - 대용량 파일 (2시간+) 점진적 로딩

2. **뷰 모드**
   - Monitor ↔ Track 전환
   - 전환 시 currentTime 동기화

3. **Track View 상호작용**
   - 마우스 휠 줌/패닝
   - 클릭으로 시간 이동
   - 트랙 필터 작동
   - 범위 선택 후 내보내기

4. **내보내기**
   - 스크린샷 PNG/SVG 저장
   - CSV 데이터 정확성
   - 클립 파일 재로드 가능 여부

### 15.2 성능 테스트

- 60fps 유지 확인 (Chrome DevTools)
- 메모리 사용량 모니터링
- 대용량 파일 로딩 시간 측정

### 15.3 브라우저 테스트

- Chrome, Firefox, Safari, Edge에서 기능 검증

---

## 16. 결정 사항 요약

| 항목 | 결정 |
|------|------|
| 뷰 모드 | Track View + Monitor View 통합 |
| 기본 뷰 | Monitor View |
| 뷰 전환 | 사이드바 토글 |
| 레이아웃 | 접을 수 있는 사이드바 (256px) |
| 플랫폼 | 데스크탑 전용 |
| 기반 코드 | 새로 작성 (/src) |
| 기술 스택 | Vanilla JS + Vite + Tailwind CSS |
| 테마 | 의료기기 다크 테마 유지 |
| 성능 | 점진적 로딩 |
| 에러 표시 | 간단 토스트 |
| 오프라인 | 미지원 (네트워크 필수) |
